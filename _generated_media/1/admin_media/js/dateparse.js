if(typeof Array.prototype.indexOf=="undefined"){Array.prototype.indexOf=function(c){var a=this.length;for(var b=0;b<a;b++){if(this[b]==c){return b}}return -1}}if(typeof Array.prototype.filter=="undefined"){Array.prototype.filter=function(d){var c=[];var a=this.length;for(var b=0;b<a;b++){if(d(this[b])){c[c.length]=this[b]}}return c}}var monthNames=gettext("January February March April May June July August September October November December").split(" ");var weekdayNames=gettext("Sunday Monday Tuesday Wednesday Thursday Friday Saturday").split(" ");function parseMonth(b){var a=monthNames.filter(function(c){return new RegExp("^"+b,"i").test(c)});if(a.length==0){throw new Error("Invalid month string")}if(a.length>1){throw new Error("Ambiguous month")}return monthNames.indexOf(a[0])}function parseWeekday(b){var a=weekdayNames.filter(function(c){return new RegExp("^"+b,"i").test(c)});if(a.length==0){throw new Error("Invalid day string")}if(a.length>1){throw new Error("Ambiguous weekday")}return weekdayNames.indexOf(a[0])}var dateParsePatterns=[{re:/^tod/i,handler:function(){return new Date()}},{re:/^tom/i,handler:function(){var a=new Date();a.setDate(a.getDate()+1);return a}},{re:/^yes/i,handler:function(){var a=new Date();a.setDate(a.getDate()-1);return a}},{re:/^(\d{1,2})(st|nd|rd|th)?$/i,handler:function(a){var b=new Date();b.setDate(parseInt(a[1],10));return b}},{re:/^(\d{1,2})(?:st|nd|rd|th)? (\w+)$/i,handler:function(a){var b=new Date();b.setDate(parseInt(a[1],10));b.setMonth(parseMonth(a[2]));return b}},{re:/^(\d{1,2})(?:st|nd|rd|th)? (\w+),? (\d{4})$/i,handler:function(a){var b=new Date();b.setDate(parseInt(a[1],10));b.setMonth(parseMonth(a[2]));b.setYear(a[3]);return b}},{re:/^(\w+) (\d{1,2})(?:st|nd|rd|th)?$/i,handler:function(a){var b=new Date();b.setDate(parseInt(a[2],10));b.setMonth(parseMonth(a[1]));return b}},{re:/^(\w+) (\d{1,2})(?:st|nd|rd|th)?,? (\d{4})$/i,handler:function(a){var b=new Date();b.setDate(parseInt(a[2],10));b.setMonth(parseMonth(a[1]));b.setYear(a[3]);return b}},{re:/^next (\w+)$/i,handler:function(e){var f=new Date();var b=f.getDay();var c=parseWeekday(e[1]);var a=c-b;if(c<=b){a+=7}f.setDate(f.getDate()+a);return f}},{re:/^last (\w+)$/i,handler:function(a){throw new Error("Not yet implemented")}},{re:/(\d{1,2})\/(\d{1,2})\/(\d{4})/,handler:function(a){var b=new Date();b.setYear(a[3]);b.setDate(parseInt(a[2],10));b.setMonth(parseInt(a[1],10)-1);return b}},{re:/(\d{4})-(\d{1,2})-(\d{1,2})/,handler:function(a){var b=new Date();b.setYear(parseInt(a[1]));b.setMonth(parseInt(a[2],10)-1);b.setDate(parseInt(a[3],10));return b}},];function parseDateString(d){for(var a=0;a<dateParsePatterns.length;a++){var c=dateParsePatterns[a].re;var b=dateParsePatterns[a].handler;var e=c.exec(d);if(e){return b(e)}}throw new Error("Invalid date string")}function fmt00(a){if(Math.abs(parseInt(a))<10){a="0"+Math.abs(a)}return a}function parseDateStringISO(a){try{var c=parseDateString(a);return c.getFullYear()+"-"+(fmt00(c.getMonth()+1))+"-"+fmt00(c.getDate())}catch(b){return a}}function magicDate(a){var c=a.id+"Msg";try{var g=parseDateString(a.value);a.value=g.getFullYear()+"-"+(fmt00(g.getMonth()+1))+"-"+fmt00(g.getDate());a.className="";if(document.getElementById(c)){document.getElementById(c).firstChild.nodeValue=g.toDateString();document.getElementById(c).className="normal"}}catch(f){a.className="error";var b=f.message;if(b.indexOf("is null or not an object")>-1){b="Invalid date string"}if(document.getElementById(c)){document.getElementById(c).firstChild.nodeValue=b;document.getElementById(c).className="error"}}};