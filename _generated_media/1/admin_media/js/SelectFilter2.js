function findForm(a){if(a.tagName.toLowerCase()!="form"){return findForm(a.parentNode)}return a}var SelectFilter={init:function(d,a,k,s){var b=document.getElementById(d);b.id+="_from";b.className="filtered";var p=b.parentNode.getElementsByTagName("p");for(var r=0;r<p.length;r++){b.parentNode.removeChild(p[r])}var h=quickElement("div",b.parentNode);h.className=k?"selector stacked":"selector";var n=quickElement("div",h,"");n.className="selector-available";quickElement("h2",n,interpolate(gettext("Available %s"),[a]));var c=quickElement("p",n,"");c.className="selector-filter";quickElement("img",c,"","src",s+"img/admin/selector-search.gif");c.appendChild(document.createTextNode(" "));var f=quickElement("input",c,"","type","text");f.id=d+"_input";n.appendChild(b);var g=quickElement("a",n,gettext("Choose all"),"href",'javascript: (function(){ SelectBox.move_all("'+d+'_from", "'+d+'_to"); })()');g.className="selector-chooseall";var j=quickElement("ul",h,"");j.className="selector-chooser";var m=quickElement("a",quickElement("li",j,""),gettext("Add"),"href",'javascript: (function(){ SelectBox.move("'+d+'_from","'+d+'_to");})()');m.className="selector-add";var q=quickElement("a",quickElement("li",j,""),gettext("Remove"),"href",'javascript: (function(){ SelectBox.move("'+d+'_to","'+d+'_from");})()');q.className="selector-remove";var l=quickElement("div",h,"");l.className="selector-chosen";quickElement("h2",l,interpolate(gettext("Chosen %s"),[a]));var o=quickElement("p",l,gettext("Select your choice(s) and click "));o.className="selector-filter";quickElement("img",o,"","src",s+(k?"img/admin/selector_stacked-add.gif":"img/admin/selector-add.gif"),"alt","Add");var e=quickElement("select",l,"","id",d+"_to","multiple","multiple","size",b.size,"name",b.getAttribute("name"));e.className="filtered";var t=quickElement("a",l,gettext("Clear all"),"href",'javascript: (function() { SelectBox.move_all("'+d+'_to", "'+d+'_from");})()');t.className="selector-clearall";b.setAttribute("name",b.getAttribute("name")+"_old");addEvent(f,"keyup",function(i){SelectFilter.filter_key_up(i,d)});addEvent(f,"keydown",function(i){SelectFilter.filter_key_down(i,d)});addEvent(b,"dblclick",function(){SelectBox.move(d+"_from",d+"_to")});addEvent(e,"dblclick",function(){SelectBox.move(d+"_to",d+"_from")});addEvent(findForm(b),"submit",function(){SelectBox.select_all(d+"_to")});SelectBox.init(d+"_from");SelectBox.init(d+"_to");SelectBox.move(d+"_from",d+"_to")},filter_key_up:function(c,b){from=document.getElementById(b+"_from");if((c.which&&c.which==13)||(c.keyCode&&c.keyCode==13)){from.selectedIndex=0;SelectBox.move(b+"_from",b+"_to");from.selectedIndex=0;return false}var a=from.selectedIndex;SelectBox.filter(b+"_from",document.getElementById(b+"_input").value);from.selectedIndex=a;return true},filter_key_down:function(b,a){from=document.getElementById(a+"_from");if((b.which&&b.which==39)||(b.keyCode&&b.keyCode==39)){var c=from.selectedIndex;SelectBox.move(a+"_from",a+"_to");from.selectedIndex=(c==from.length)?from.length-1:c;return false}if((b.which&&b.which==40)||(b.keyCode&&b.keyCode==40)){from.selectedIndex=(from.length==from.selectedIndex+1)?0:from.selectedIndex+1}if((b.which&&b.which==38)||(b.keyCode&&b.keyCode==38)){from.selectedIndex=(from.selectedIndex==0)?from.length-1:from.selectedIndex-1}return true}};